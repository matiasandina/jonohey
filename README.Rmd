---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  fig.path   = "man/figures/README-",
  fig.width  = 9,
  fig.height = 6,
  dpi        = 150,
  fig.align  = "center",
  out.width  = "100%",
  fig.retina = 2,
  # this is needed for the fonts
  dev = "ragg_png"
)

```

# jonohey

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

The goal of jonohey is to provide color palettes inspired by Jono Hey's sketches at [Sketchplanations](https://sketchplanations.com/).

::: {.callout}
These palettes were not selected following criteria of color theory or accessibility. You might find that separability is not grat, especially when the number of colors is large. These palettes are intended for fun and to add a sketchy aesthetic to your visualizations. Use what works, toss the rest. Cution advised in professional settings!
:::


## Installation

You can install the development version of jonohey from [GitHub](https://github.com/matiasandina/jonohey) with:

``` r
# install.packages("pak")
pak::pak("matiasandina/jonohey")
```

## Example

These examples display the color palettes themselves. For utilization of the package, check [the docs](matiasandina.github.io/jonohey/) ðŸ“–. 

```{r example}
library(jonohey, quietly = TRUE)
library(patchwork)
library(ggplot2)

plot_box_mtcars <- function(palette_name) {
  d <- transform(mtcars, cyl = factor(cyl))
  ggplot(d, aes(cyl, mpg, fill = cyl)) +
    geom_boxplot(width = 0.7) +
    scale_fill_jonohey(palette_name) +
    labs(title = "Boxplot: mtcars mpg by cyl") 
}

plot_box_mtcars("suit")

```

We provide themes to make this plot a bit more interesting (and closer in nature to their true sketch identity!).

```{r sketch}
# make a round panel!
plot_box_mtcars("suit") + theme_card(radius_panel = 18)
```

> Typography matches exactly in saved figures or Rmd configured with `dev = "ragg_png"`. For interactive plotting, `call jonohey_use_ragg()` or install Fuzzy Bubbles system-wide.

```{r}
# Make it more cartoonish
plot_box_mtcars("suit") + theme_axes_wiggle()
```

Check ðŸ“– [the docs](matiasandina.github.io/jonohey/)!

### Palettes

We display available palettes with some toy examples below

```{r include=FALSE}

# one-row swatch plot
show_swatches_gg <- function(palette_name) {
  pal <- jonohey_pal(palette_name)
  df <- data.frame(i = seq_along(pal), col = unname(pal), lab = names(pal))
  ggplot(df) +
    geom_rect(aes(xmin=i, xmax=i+1, ymin=-1.5, ymax=1.5, fill = col)) +
    geom_text(aes(x=i + 0.5, y=-1.7, label=lab)) +
    geom_text(aes(x=i + 0.5, y=-1.9, label=col)) +
    scale_fill_identity() +
    scale_x_continuous(expand = c(0,0)) +
    scale_y_continuous(limits = c(-2.5, 2.5), expand = c(0, 0)) +
    labs(title = palette_name,
         x = "",
         y = "") +
    theme_card(radius_panel = 18) +
    theme(axis.text = element_text(colour = "transparent"))
}


plot_box_mtcars <- function(palette_name) {
  d <- transform(mtcars, cyl = factor(cyl))
  ggplot(d, aes(cyl, mpg, fill = cyl)) +
    geom_boxplot(width = 0.7) +
    scale_fill_jonohey(palette_name) +
    labs(title = "Boxplot: mtcars mpg by cyl") +
    theme_card(radius_panel = 18)
}

plot_scatter_lm <- function(palette_name) {
  d <- transform(mtcars, gear = factor(gear))
  ggplot(d, aes(wt, mpg, colour = gear)) +
    geom_point(size = 3, alpha = 0.9) +
    geom_smooth(method = "lm", se = FALSE, linewidth = 1) +
    scale_color_jonohey(palette_name) +
    labs(title = "Scatter + LM: mpg ~ wt by gear") +
    theme_card(radius_panel = 18)
}


set.seed(2025-10-22)

make_beeswarm_data6 <- function(n_per_group = 60, n = 4) {
  g <- factor(rep(LETTERS[1:n], each = n_per_group), levels = LETTERS[1:4])
  idx <- as.integer(g)
  y <- 10 + 2.2 * idx + rnorm(length(idx), sd = 1.8)
  data.frame(group = g, score = y)
}

plot_beeswarm6 <- function(palette_name = "color_wheel") {
  stopifnot(requireNamespace("ggbeeswarm", quietly = TRUE))
  d <- make_beeswarm_data6()
  ggplot(d, aes(group, score, colour = group)) +
    ggbeeswarm::geom_quasirandom(alpha = 0.6, size = 2, width = 0.25) +
    ggplot2::stat_summary(fun = median, geom = "point", size = 3, shape = 95, colour = "black") +
    ggplot2::stat_summary(fun = median, geom = "text", aes(label = sprintf("%.1f", after_stat(y))),
                          vjust = -0.8, size = 3) +
    scale_color_jonohey(palette_name) +
    labs(title = "Beeswarm of toy data",
         x = "Group", 
         y = "Score") +
    theme_card(radius_panel = 18) +
    theme(legend.position = "none")
}


plot_ucb_dept <- function(palette_name) {
  d <- as.data.frame(UCBAdmissions) |>
    dplyr::filter(Admit == "Admitted") |> 
    dplyr::summarise(.by= Dept, Freq = sum(Freq))
  # sum or directly use: each row has Freq count
  ggplot(d, aes(Dept, Freq, fill = Dept)) +
    geom_col() +
    scale_fill_jonohey(palette_name) +
    labs(title = "UCB Admissions by Department", y = "Count") +
    theme_card(radius_panel = 18)
}


```

```{r, include = FALSE}
library(patchwork)

jonohey_showcase <- function(palette_name) {

  pal <- jonohey_pal(palette_name)
  img_path <- list.files(path = "img/", 
                         pattern = glue::glue("{palette_name}"), full.names = TRUE)
  k <- length(pal)

  # a) sketch
  #img <- magick::image_read(img_path) |>
  #     magick::image_scale("2400x") |>
  #     magick::image_background("none") |>
  #     magick::image_extent("2600x", gravity = "center")
  #rg <- grid::rasterGrob(as.raster(img), interpolate = TRUE)
  #g_img <- patchwork::wrap_elements(rg, full = TRUE)
  
  g_img <- cowplot::ggdraw() + cowplot::draw_image(img_path) +
    theme(
      # harcoding the plot margin is not great but kinda works?
      plot.margin = margin(0,0,40,0),
      # keep to see how many px to add
      #plot.background = element_rect(color = "black")
      )
  
  # b) swatches
  g_swatches <- show_swatches_gg(palette_name)

  # c) boxplot
  g_box <- plot_box_mtcars(palette_name)

  # d) continuous with LM
  g_lm <- plot_scatter_lm(palette_name)

  # e) beeswarm for >=4
  g_bee <- if (k >= 6) {
    plot_beeswarm6(palette_name)
  } else {
    ggplot() + 
      theme_void()
  }

  # f) stacked area for â‰¥6
  g_bar <- if (k >= 6) {
    plot_ucb_dept(palette_name)
  } else {
    ggplot() + 
      theme_void() 
  }

col1 <- (g_img / plot_spacer() / g_lm) + plot_layout(heights = c(1, .1, 1))
col2 <- (g_swatches / plot_spacer() / g_bee) + plot_layout(heights = c(1, .1, 1))
col3 <- (g_box / plot_spacer() / g_bar) + plot_layout(heights = c(1, .1, 1))

col1 | col2 | col3 + plot_layout(widths = c(1,1,1))
}

```

```{r, include=FALSE, message=FALSE, warning=FALSE}
pals_to_display <- jonohey_palettes()[3:length(jonohey_palettes())]
# remove palettes with no image to associate
pals_to_display <- pals_to_display[!pals_to_display %in% c("light", "dark")]

plot_li <- purrr::map(
  pals_to_display,
  function(tt) jonohey_showcase(tt)
)
```


```{r, include=FALSE, message=FALSE, warning=FALSE}
export_showcase <- function(pal, plot) {
  fn <- glue::glue("man/figures/{pal}.png")
  invisible(
    ggsave(
      filename = fn,
      plot     = plot,
      width    = 12,   # inches
      height   = 8,    # tune to your layout
      dpi      = 200,
      # bg       = "white", might mess with dark modes in github
      device   = ragg::agg_png,
      scale = 2
)
  )

}


purrr::walk2(pals_to_display, plot_li, export_showcase)

```

```{r, echo=FALSE, results='asis'}
for (pal in pals_to_display) {
  link <- readr::read_delim("links.csv", delim = ",", show_col_types = FALSE) |>
    dplyr::filter(short_name == pal) |> 
    dplyr::pull(url)

  # write a markdown paragraph before the image
  cat("\n\n### ", pal, "\n\n", sep = "")
  cat("Below is the showcase for the **", pal, "** palette.\n\n", sep = "")
  cat("You can find the source for the sketch inspiring the palette at [Sketchplanations](", link, ")", sep="")
  
  cat("\n\n---\n\n")

  # include the image
  cat(paste0("![](", glue::glue("man/figures/{pal}.png"), ")\n\n"), sep = "")

  # add a bit of space after each image
  cat("\n\n---\n\n")
}
```

There are two palettes without associated images: "light" and "dark". They contain 9 colors each, in light and dark tones respectively.

```{r lightpal}
jonohey_show("light")
```

```{r darkpal}
jonohey_show("dark")
```

These palettes have 9 colors, which can be useful for plotting categorical data with many levels.

```{r exampe9_light}

p_bar <- dplyr::storms  |> 
  dplyr::count(status) |>
  dplyr::mutate(status = forcats::fct_reorder(status, n, .desc = TRUE)) |>
  ggplot(aes(n, status, fill=status)) + 
  geom_col(show.legend = FALSE, color = "black") +
  theme_card(base_size = 12, radius_panel = 10)

xy_summ <- dplyr::storms |> 
  dplyr::group_by(status) |> 
  dplyr::summarise(
    n = dplyr::n(),
    wind_mean = mean(wind, na.rm = TRUE),
    wind_sd   = sd(wind,   na.rm = TRUE),
    pres_mean = mean(pressure, na.rm = TRUE),
    pres_sd   = sd(pressure,   na.rm = TRUE),
    .groups = "drop"
  ) |> 
  dplyr::mutate(
    wind_ci = qt(0.999, df = pmax(n - 1, 1)) * wind_sd / sqrt(n),
    pres_ci = qt(0.999, df = pmax(n - 1, 1)) * pres_sd / sqrt(n),
    xmin = wind_mean - wind_ci, xmax = wind_mean + wind_ci,
    ymin = pres_mean - pres_ci, ymax = pres_mean + pres_ci
  )

p <- ggplot(xy_summ, aes(wind_mean, pres_mean, fill = status)) +
  geom_point(size = 3, pch = 21) +
  geom_errorbar(aes(ymin = ymin, ymax = ymax, color = status), width = 0, show.legend = FALSE) +
  geom_errorbarh(aes(xmin = xmin, xmax = xmax, color = status), height = 0, show.legend = FALSE) +
  theme_card(base_size = 12, , radius_panel = 10) +
  labs(x = "Wind", y = "Pressure", color = "Status") +
  theme(legend.position = "none",
  )


p_bar + 
  scale_fill_jonohey("light") +
  labs(title = "Using the 'light' palette in dplyr::storms data") +
p + 
  scale_fill_jonohey("light") +
  scale_color_jonohey("light")
  
```



```{r exampe9_dark}
p_bar + 
  scale_fill_jonohey("dark") +
  labs(title = "Using the 'dark' palette in dplyr::storms data") +
p + 
  scale_fill_jonohey("dark") +
  scale_color_jonohey("dark") 


```



## Using ragg for consistent typography

Since we provide a custom font ("Fuzzy Bubbles") to match a sketchy look, we recommend using the `ragg` graphics device for saving plots to ensure consistent typography. You can do this by calling `jonohey_use_ragg()` once in your R session, or by specifying `dev = "ragg_png"` in your R Markdown document's chunk options. 

In Rstudio, you can also set `ragg` as the default graphics device in the Global Options under the "General" section. Check the [Ragg's documentation](https://ragg.r-lib.org/index.html?q=rstu#use-ragg-in-rstudio) for more details.

In Positron, it seems that `ragg` is used by default if ragg >= 1.4 (see [this PR](https://github.com/posit-dev/ark/pull/763)). That's why we require ragg >= 1.4 in the DESCRIPTION. We have tested `jonohey_use_ragg()` and it seems to work, but the scaling is worse than in RStudio.

## Issues

This is a preliminary release, file issues to improve the package.


## Acknowledgements

::: {.callout}
Shoutout to Jono Hey for the inspiration and permission to use his sketches as a basis for color palettes!

You can find Jono Hey's work at [Sketchplanations](https://sketchplanations.com/).
:::
